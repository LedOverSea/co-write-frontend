# 版本控制系统

## 主要功能
- 手动创建版本快照，支持版本名称和描述
- 版本恢复前自动创建备份（命名规则：恢复前备份-时间戳）
- 支持版本内容对比，使用Java Diff Utils库
- 版本内容以LONGBLOB格式存储，支持大文档
- 每个版本记录创建者和创建时间


## 1.版本控制系统的技术选型
### 1.1 Git
Git 是强大的分布式版本控制系统，在代码管理领域应用广泛，通过适配也能用于在线文档版本控制。​
* 实现方式：将在线文档内容以文本形式存储在 Git 仓库中，每次文档保存时视为一次提交。利用 Git 的命令行工具或 Java、Python 等语言的 Git 库（如 JGit、GitPython），在后端处理版本操作，如提交、合并、回滚等。前端采用 JavaScript 框架（如 Vue.js、React）开发交互界面，展示文档版本历史、差异对比等信息。​
* 优势：具备成熟的版本管理功能，如分支管理、冲突解决、历史追溯等；拥有庞大的开发者社区，遇到问题易获取解决方案；分布式特性让数据存储和访问更灵活。​
* 劣势：对于非代码类文档，需额外处理格式转换（如将 Word 文档转换为纯文本）；Git 操作相对复杂，普通用户使用门槛较高

### 1.2 Subversion（SVN）
SVN 是集中式版本控制系统，适合团队协作场景。​
* 实现方式：搭建 SVN 服务器，将在线文档存储在 SVN 仓库中。后端使用 Java 或 Python 编写服务程序，调用 SVN 客户端库（如 svnkit、pysvn）实现版本控制操作。前端同样使用 Web 技术构建用户界面，方便用户查看和操作文档版本。​
* 优势：操作相对简单，适合不熟悉复杂版本控制概念的用户；集中式管理便于统一权限控制和数据管理。​
* 劣势：依赖服务器，网络中断时无法提交或获取版本；相比 Git，分支管理和合并功能较弱。

### 1.3 基于数据库的版本控制​
利用关系型数据库（如 MySQL、PostgreSQL）或非关系型数据库（如 MongoDB）存储文档版本数据。​
* 实现方式：为每个文档创建版本表，记录文档的不同版本内容、修改时间、修改人等信息。每次文档保存时，将新内容插入版本表。通过 SQL 语句或数据库操作库（如 Java 的 JDBC、Python 的 pymongo）查询和管理版本数据。前端展示版本列表，支持用户选择版本进行查看和回滚。​
* 优势：可高度定制化，根据业务需求灵活设计数据结构和功能；数据库的事务处理能保证数据一致性和完整性。​
* 劣势：需自行开发完整的版本控制逻辑，如差异计算、冲突解决等；随着文档版本增多，数据库存储压力增大，需进行性能优化。

本项目最终选择的方案是:使用关系型数据库MySQL,创建一张版本表,保存文档的版本信息。这是考虑到：1.文档表保存在MySQL中，版本表与文档表保持一致，便于统一管理和维护。2.本项目数据规模不大，数据库存储压力较小。所以，这个方案有较强的可行性。

与其他方案对比，git在代码管理领域应用广泛，但对于文档类型兼容性较差。SVN依赖于服务器，需要联网进行操作，而本项目不依赖于服务器，完全可以在本地运行。


## 2. 差异比较

在实际应用中，文本差异比较可细分为不同层级。字符级差异比较聚焦于单个字符的增删改，例如将 “apple” 修改为 “apples”，差异比较工具会明确标记出新增的 “s”；行级差异比较则以文本行为单位，常用于分析代码文件或结构化文本，当代码文件中某一行被删除或新增时，能快速定位该行的变动；段落级差异比较更适用于篇幅较长的文档，如学术论文、报告等，通过对比段落结构与内容，判断段落是否存在调整、合并或拆分情况。​

文本差异比较的结果通常以可视化的形式呈现，常见方式有统一格式的差异文本输出，用 “+” 表示新增内容、“-” 表示删除内容；也可以生成 HTML 格式的差异报告，通过颜色高亮、批注等方式，直观展示文本差异，便于用户快速理解文本内容的变化情况。

差异比较主要有两种可选方案，一是先前端从后端获得两个版本的内容，然后在前端进行比较，二是在后端处理差异比较，将比较结果返回给前端。下一节是两种方案使用场景的对比。

### 2.1 使用前端和后端进行文本比较的使用场景

| **场景**                  | **推荐技术**              | **理由**                              |
| ----------------------- | --------------------- | ----------------------------------- |
| 浏览器端实时文本 / JSON 比较&#xA; | JavaScript&#xA;       | 无需后端，直接在网页中运行，响应迅速。&#xA;            |
| 大型文档 / 二进制格式比较&#xA;     | Java&#xA;             | 高性能处理大文件，支持复杂格式解析（如 PDF、Word）。&#xA; |
| 企业级文档管理系统&#xA;          | Java（后端）+ JS（前端）&#xA; | 后端处理差异计算，前端展示结果，兼顾性能和用户体验。&#xA;     |
| 快速原型或轻量级工具&#xA;         | JavaScript&#xA;       | 生态丰富，开发效率高。&#xA;                    |

*   **JavaScript** 适合前端可视化、动态数据比较和轻量级应用。

*   **Java** 适合高性能、复杂文档处理和企业级后端集成。

本项目最终使用Java 处理核心算法，JS 负责前端展示，实现文档差异比较功能。

### 2.2 差异比较的核心技术
<a src = 'https://github.com/java-diff-utils/java-diff-utils'>java-diff-utils</a>的官方文档：

> Diff Utils 库是一个开源库，用于执行文本之间的比较操作：计算差异、应用补丁、生成或解析统一格式的差异文件，以及生成便于未来展示的差异输出（如并排视图）等。<br>
构建此库的主要原因是缺乏易于使用且包含处理差异文件时所需所有常用功能的库。它最初受到 JRCS 库及其出色的差异模块设计的启发。<br>
该库最初是从 Google Code Archive 上的 java-diff-utils 项目派生而来的。

基于Myer's Diff和HistogramDiff算法

| **维度**    | **Myer's Diff**           | **HistogramDiff**       |
| --------- | ------------------------- | ----------------------- |
| **核心思想**  | 最短编辑路径搜索&#xA;             | 特征频率分布比较&#xA;           |
| **差异粒度**  | 字符级 / 行级&#xA;             | 块级 / 语义级&#xA;           |
| **时间复杂度** | 平均 O (n+d²)（d 为编辑距离）&#xA; | O (m+n)（m、n 为特征数量）&#xA; |
| **适用场景**  | 小范围精确差异比较&#xA;            | 大规模文本或语义差异分析&#xA;       |
| **典型应用**  | 代码版本控制、文本编辑器&#xA;         | 文档查重、数据集合比对&#xA;        |

支持text,html,json结构对比。如果版本表中的文档内容数据是json格式，则解析后分别比较text,html,json数据，否则当作纯文本处理，只比较text。最终返回VO数据在前端渲染。

## 3. 未来展望
* 分支、合并操作 

在团队协作中避免代码冲突，保持分支间的更新同步。需要处理不同分支之间冲突的问题。

* 权限与安全机制

需要和权限管理功能协同开发，对版本控制实现用户认证、资源授权的逻辑。

对安全机制，可以增加审计记录。通过日志记录、追踪版本控制系统中所有关键操作，确保操作的可追溯性。

* 创建版本时自动保存——提高用户体验

创建版本的逻辑在后端实现，目前是从页面保存到文档表，再从文档表保存到版本表。页面数据和数据库中的数据不一致，降低用户体验，后续可能需要对文档保存和创建版本的逻辑进行进一步优化。